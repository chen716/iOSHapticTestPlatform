<!DOCTYPE html>
<html lang="en" class="">
    <head>
        <meta charset="UTF-8" />

        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" />
        <script src="//cdnjs.cloudflare.com/ajax/libs/react/17.0.2/umd/react.production.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/react-dom/17.0.2/umd/react-dom.production.min.js"></script>
        <script src="//unpkg.com/@rjsf/core/dist/react-jsonschema-form.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <link rel="stylesheet" href="assets/corestyle.css" />
       
       <script>
        function displayForm() {
            let serverURL="http://localhost:3000/";
            let finalResult;
            const Form = JSONSchemaForm.default;
            const urls = ["assets/formschema.json", "assets/formuischema.json"];
            Promise.all(urls.map(url => fetch(url).then(e => e.json()))).then(data => {
                finalResult = data.flat();
                ReactDOM.render(React.createElement(Form, {schema: finalResult[0],uiSchema: finalResult[1],onSubmit: e => setFormData(e.formData)}), document.getElementById("app"));
            });
        }

        function setFormData(formData)
        {
            console.log(formData.survey_url);
            renderTable();
        }

        function openModal() {
            var modal = document.getElementById("myModal");
            displayForm();
            modal.style.display = "block";
        }

        function closeModal() {
            renderTable();
            var modal = document.getElementById("myModal");
            
            modal.style.display = "none";
        }
        
        function renderTable(){       
            fetch("assets/dummy.json").then(res => res.json()).then((data) => {
                console.log(data)
                var temp ="<table class='styled-table'><tr><th>ID</th><th>Description</th><th>Interaction Type</th><th>Survey URL</th></tr>";
                for( var i=0;i<data.length;i++){
                    temp += "<tr>";
                        temp += "<td>";
                            temp += data[i].hashs;
                        temp += "</td>";
                        temp += "<td>";
                            temp += data[i].haptic_setup[0].experiment_description;
                        temp += "</td>";
                        temp += "<td>";
                            temp += data[i].haptic_setup[0].interaction_type;
                        temp += "</td>";
                        temp += "<td>";
                            temp += data[i].haptic_setup[0].survey_url;
                        temp += "</td>";
                    temp += "</tr>";   
                }
                temp +="</table>"
                $('#root').html(temp)
            }).catch(err => {throw err}); 
        }

        </script>
    </head>

    <body onload="renderTable();">
        <button class="button-24" style="float: right; margin: 40px;" onclick="openModal(); ">+</button>
        <div id="root" class="center" ></div>
        <div id="myModal" class="modal">
            <div class="modal-content">
              <span class="close" onclick="closeModal()">&times;</span>
              <div id="app"></div>
            </div>          
        </div>
    </body>
</html>
